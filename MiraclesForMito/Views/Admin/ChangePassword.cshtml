@using MiraclesForMito.Models;
@using MiraclesForMito.Utilities;

@{
	ViewBag.Title = "Change Your Password";
	Layout = "~/Views/Shared/_AdminLayout.cshtml";
	ViewBag.Active = "users";
}

<h1>@ViewBag.Title</h1>

<div class="row main-page-section">
	<div class="col-md-12 col-lg-10 col-md-offset-0 col-lg-offset-1">

		<div class="row">
			<div class="col-md-12 col-lg-12">
				<form id="ChangePasswordForm" action="~/API/BlogPost/" method="put" class="form-horizontal" role="form">

					<input type="hidden" id="id" name="id" value="@UserUtils.CurrentUser.ID" />

					<div class="form-group">
						<label for="OldPassword" class="col-sm-2 control-label">Old Password</label>
						<div class="col-sm-6">
							<input type="text" class="form-control" id="OldPassword" name="OldPassword" placeholder="Enter old password" value="" />
						</div>
					</div>

					<div class="form-group">
						<label for="NewPassword" class="col-sm-2 control-label">New Password</label>
						<div class="col-sm-6">
							<input type="text" class="form-control" id="NewPassword" name="NewPassword" placeholder="Enter new password" value="" />
						</div>
					</div>

					<div class="form-group">
						<label for="NewPasswordConfirm" class="col-sm-2 control-label">Confirm Password</label>
						<div class="col-sm-6">
							<input type="text" class="form-control" id="NewPasswordConfirm" name="NewPasswordConfirm" placeholder="Retype new password" value="" />
						</div>
					</div>

					<div class="form-group">
						<div class="col-sm-offset-2 col-sm-10">
							<button type="submit" class="btn btn-success">Update Password</button>
							<button id="CancelChanges" type="button" class="btn btn-danger">Cancel</button>
						</div>
					</div>

				</form>
			</div>
		</div>

	</div>
</div>

@section scripts{
	<script type="text/javascript">
		$(function ()
		{
			var $SavePasswordForm = $("#ChangePasswordForm");

			$("#CancelChanges").on("click", function(){
				window.location = "~/Admin/AdminUsers".ResolveUrl();
			});

			$SavePasswordForm.submit(function (e)
			{
				e.preventDefault();

				var sSuccesMessage = "Password Updated!";
				var sFailMessage = "Failed to update password!";

				$.ajax({
					url: "~/Admin/ChangePassword/".ResolveUrl(),
					type: "POST",
					data: $SavePasswordForm.serialize()
				})
				.done(
					function ()
					{
						alert(sSuccesMessage);
						window.location = "~/Admin/AdminUsers".ResolveUrl();
					}
				)
				.fail(function () { alert(sFailMessage) });
			});
		});
	</script>
}