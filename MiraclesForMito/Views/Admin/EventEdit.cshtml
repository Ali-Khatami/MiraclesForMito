@using MiraclesForMito.Models;
@model Event

@{
    ViewBag.Title = "Edit Event";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
	ViewBag.Active = "event";
	Event modelToUse = Model;
	bool bIsCreate = false;
	
	// Model
	if (modelToUse == null)
	{
		modelToUse = new Event(){ ID = -1 };
		bIsCreate = true;
		ViewBag.Title = "Create Event";
	}
}

<h1>@ViewBag.Title</h1>

<div class="row main-page-section">
	<div class="col-md-12 col-lg-10 col-md-offset-0 col-lg-offset-1">

		<div class="row">
			<div class="col-md-12 col-lg-12">
				<form id="EventEditForm" action="~/API/Event/" method="put" class="form-horizontal" role="form">

					<input type="hidden" id="id" name="id" value="@modelToUse.ID" />

					<div class="form-group">
						<label for="Name" class="col-sm-2 control-label">Name</label>
						<div class="col-sm-5">
							<input type="text" class="form-control" id="Name" name="name" placeholder="Name" value="@modelToUse.Name" />
						</div>
					</div>

					<div class="form-group">
						<label for="Description" class="col-sm-2 control-label">Description</label>
						<div class="col-sm-10">
							<textarea class="form-control" id="Description" name="description" placeholder="Description">@modelToUse.Description</textarea>
						</div>
					</div>
			
					<div class="form-group">
						<div class="col-sm-offset-2 col-sm-6">
							<button type="submit" class="btn btn-success">@(bIsCreate ? "Save Event" : "Save Changes")</button>
							<button id="CancelChanges" type="button" class="btn btn-danger">Cancel</button>
						</div>
					</div>

					<div class="form-group">
						<label for="StartDate" class="col-sm-2 control-label">Start Date</label>
						<div class="col-sm-2">
							<input type="text" class="form-control" id="StartDate" name="StartDate" placeholder="StartDate" value="@modelToUse.StartDate" />
						</div>
					</div>

					<div class="form-group">
						<label for="EndDate" class="col-sm-2 control-label">End Date</label>
						<div class="col-sm-2">
							<input type="text" class="form-control" id="EndDate" name="EndDate" placeholder="EndDate" value="@modelToUse.EndDate" />
						</div>
					</div>

					<div class="form-group">
						<label for="Address1" class="col-sm-2 control-label">Address</label>
						<div class="col-sm-6">
							<input type="text" class="form-control" id="Address1" name="Address1" placeholder="Address1" value="@modelToUse.Address1" />
						</div>
					</div>

					<div class="form-group">
						<label for="Address2" class="col-sm-2 control-label">Address (cont'd.)</label>
						<div class="col-sm-6">
							<input type="text" class="form-control" id="Address2" name="Address2" placeholder="Address2" value="@modelToUse.Address2" />
						</div>
					</div>

					<div class="form-group">
						<label for="City" class="col-sm-2 control-label">City</label>
						<div class="col-sm-4">
							<input type="text" class="form-control" id="City" name="City" placeholder="City" value="@modelToUse.City" />
						</div>
					</div>

					<div class="form-group">
						<label for="State" class="col-sm-2 control-label">State</label>
						<div class="col-sm-4">
							<input type="text" class="form-control" id="State" name="State" placeholder="State" value="@modelToUse.State" />
						</div>
					</div>

					<div class="form-group">
						<label for="Zip" class="col-sm-2 control-label">Zip</label>
						<div class="col-sm-2">
							<input type="text" class="form-control" id="Zip" name="Zip" placeholder="Zip" value="@modelToUse.Zip" />
						</div>
					</div>

					<div class="form-group">
						<label class="col-sm-2 control-label">Contact Info</label>
					</div>

					<div class="form-group">
						<label for="ContactNumber" class="col-sm-2 control-label">Person/Company</label>
						<div class="col-sm-2">
							<input type="text" class="form-control" id="Zip" name="Zip" placeholder="Zip" value="@modelToUse.Zip" />
						</div>
					</div>

				</form>
			</div>
		</div>

	</div>
</div>

@section scripts{
	<script type="text/javascript">
		$(function ()
		{
			var jEventEditForm = $("#EventEditForm");

			$("#CancelChanges").on("click", function(){
				var bConfirmCancel = confirm("Are you sure you want to cancel? Any changes made will not be saved.");

				if(bConfirmCancel)
				{
					window.location = "~/Admin/Event".ResolveUrl();
				}
			});

			jEventEditForm.submit(function (e)
			{
				e.preventDefault();

				var sUrl = "~/API/Event/".ResolveUrl();
				var sAction = "PUT";
				// written from serverside.
				var bIsCreate = @bIsCreate.ToString().ToLower();
				var sSuccesMessage = "Updated!";
				var sFailMessage = "Failed to update!";

				if (bIsCreate)
				{
					sAction = "POST";
					sSuccesMessage = "Created!";
					sFailMessage = "Failed to create!";
				}
				else
				{
					sUrl += $('#id').val();
				}

				$.ajax({
					url: sUrl,
					type: sAction,
					data: jEventEditForm.serialize()
				})
				.done(
					function ()
					{
						alert(sSuccesMessage);
						window.location = "~/Admin/Events".ResolveUrl();
					}
				)
				.fail(function () { alert(sFailMessage) });
			});
		});
	</script>
}